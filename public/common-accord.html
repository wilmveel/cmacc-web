<!-- Imports polymer -->
<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-ajax/iron-ajax.html">

<link rel="import" href="./cmacc-elements/cmacc-app.html">

<dom-module id="common-accord">

    <template>
        <cmacc-app id="ast" base="{{base}}" files="{{files}}" ast="{{ast}}"></cmacc-app>
    </template>

</dom-module>


<script>
    Polymer({
        is: 'common-accord',

        properties: {
            ast: {
                type: Object
            },
            files: {
                type: Array
            }
        },

        ready: function () {
            this.base = window.location.href;

            console.log(this.base, window.location.href);
            this.addEventListener("cmacc-link", function (e) {
                var ref = e.detail.data;
                var file = cmacc.resolve(this.ast.file, ref);
                console.log('GO', ref, this.ast.file, file);
                this.file = file;

                window.open(this.base + '?doc=' + file, '_blank');
            }.bind(this), true);

        },

        attached: function () {

            var files = [
                'doc/test.md',
                'doc/marc/HelloWorld.md',
                'doc/marc/HelloWorldOverwrite.md',
                'doc/acme/angel-round/SAFE_Robinson.md',
                'doc/acme/angel-round/SAFE_Robinson_v2.md',
                'doc/acme/angel-round/safe_robinson_v3.md'
            ];

            this.set('files', files);

        }

    });
</script>